# CAP AI Demo

Este projeto Ã© uma API baseada no SAP Cloud Application Programming Model (CAP) integrada com SAP HANA Cloud e SAP AI Core.

## ğŸš€ Tecnologias Utilizadas

- **SAP CAP** (Cloud Application Programming Model)
- **SAP HANA Cloud**
- **Node.js**
- **Express**
- **OData V4**
- **Swagger UI**
- **Helmet e CORS** para seguranÃ§a

##  Estrutura do Projeto

```plaintext
cap-ai-gabriel-marangoni
â”‚-- .github/
â”‚   â”œâ”€â”€ workflows/             # ConfiguraÃ§Ãµes para CI/CD
â”‚-- collection/                # Arquivos de requisiÃ§Ã£o HTTP para testes
â”‚   â”œâ”€â”€ embeddings.http
â”‚   â”œâ”€â”€ rag.http
â”‚-- db/                        # DefiniÃ§Ãµes do banco de dados (HANA Cloud)
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ DocumentChunk.cds  # DefiniÃ§Ã£o da entidade DocumentChunk
â”‚-- gen/                       # Arquivos gerados pelo CAP
â”‚-- mta_archives/              # Arquivos de deployment MTA
â”‚-- node_modules/              # DependÃªncias Node.js
â”‚-- srv/                       # LÃ³gica de serviÃ§o e negÃ³cios
â”‚   â”œâ”€â”€ adapters/              # Adaptadores de dados
â”‚   â”‚   â”œâ”€â”€ BufferAdapter.js
â”‚   â”‚   â”œâ”€â”€ SplitterAdapter.js
â”‚   â”œâ”€â”€ api/                   # Middlewares para seguranÃ§a
â”‚   â”‚   â”œâ”€â”€ cors.js
â”‚   â”‚   â”œâ”€â”€ helmet.js
â”‚   â”œâ”€â”€ gateways/              # IntegraÃ§Ã£o com sistemas externos
â”‚   â”‚   â”œâ”€â”€ LLMGateway.js
â”‚   â”œâ”€â”€ repositories/          # Camada de acesso a dados
â”‚   â”‚   â”œâ”€â”€ DocumentChunkRepository.js
â”‚   â”œâ”€â”€ embeddings-service.cds  # DefiniÃ§Ã£o do serviÃ§o OData para embeddings
â”‚   â”œâ”€â”€ embeddings-service.js   # ImplementaÃ§Ã£o do serviÃ§o de embeddings
â”‚   â”œâ”€â”€ rag-service.cds         # DefiniÃ§Ã£o do serviÃ§o OData para RAG
â”‚   â”œâ”€â”€ rag-service.js          # ImplementaÃ§Ã£o do serviÃ§o RAG
â”‚-- .cdsrc.json                 # ConfiguraÃ§Ã£o do projeto CAP
â”‚-- mta.yaml                    # ConfiguraÃ§Ã£o do SAP Cloud Foundry MTA
â”‚-- package.json                # ConfiguraÃ§Ã£o do Node.js
â”‚-- xs-security.json            # ConfiguraÃ§Ã£o de seguranÃ§a do SAP BTP
```


## ğŸ”§ Como Executar o Projeto

### 1ï¸âƒ£ PrÃ©-requisitos

- Node.js e npm instalados
- Instalar a CLI do CAP:  
```sh
npm install -g @sap/cds-dk
```

### Login no Cloud Foundry

```bash
cf login
```

### 2ï¸âƒ£ Instalar DependÃªncias

```bash
npm install
```

### 3ï¸âƒ£ Executar o Projeto Localmente

```bash
cds watch
```

O servidor estarÃ¡ disponÃ­vel em `http://localhost:4004`.

### 4ï¸âƒ£ Deploy no Cloud Foundry

Gerar o artefato `.mtar`

```bash
mbt build
```

Executar deploy no SAP BTP:

```bash
cf deploy mta_archives/<nome_do_artefato>.mtar
```

##  ğŸ“Œ Endpoints

- `GET /embeddings/DocumentChunk` â†’ Retorna os documentos cadastrados
- `POST /embeddings/createEmbeddings` â†’ Cria embeddings para um texto
- `GET /rag/DocumentChunk` â†’ Retorna os documentos no contexto RAG

##  ğŸ”’ SeguranÃ§a

O projeto utiliza:

- Helmet.js para proteÃ§Ã£o HTTP headers
- CORS para controle de acessos
- AutenticaÃ§Ã£o via xsuaa